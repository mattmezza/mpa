<div>
  <div class="flex items-start justify-between gap-3 flex-wrap">
    <div>
      <h3 class="text-base mb-1">WhatsApp setup</h3>
      <p class="text-xs text-muted">
        The WhatsApp bridge runs as a separate service. When you start auth, it generates a QR code to link your
        WhatsApp account. After linking, the bridge relays messages to this server and the agent responds back.
      </p>
    </div>
    <div class="badge-off">Bridge required</div>
  </div>

  <input type="hidden" id="ch-wa-bridge" value="{{ bridge_url|default('http://localhost:3001') }}">
  <input type="hidden" id="ch-wa-token" value="{{ bridge_token|default('') }}">

  <div class="mt-3">
    <label class="label" for="ch-wa-numbers">Allowed numbers</label>
    <input type="text" class="input" id="ch-wa-numbers" placeholder="+14155551234, +442071838750"
           value="{{ allowed_numbers|default('') }}">
    <div class="hint">Comma-separated international numbers. Leave empty to allow any sender.</div>
  </div>

  <div class="mt-3">
    <label class="label" for="ch-wa-enabled">Channel status</label>
    <div class="flex items-center gap-2 text-xs">
      <input type="checkbox" id="ch-wa-enabled" class="input-sm" style="width: auto;"
             {% if enabled|default('true') == 'true' %}checked{% endif %}>
      <span>Enable WhatsApp channel</span>
    </div>
  </div>

  <div class="flex items-center gap-2 mt-4">
    <button class="btn btn-sm" type="button" onclick="testWhatsApp()">Test bridge</button>
    <button class="btn btn-sm" type="button" onclick="sendWhatsAppTestMessage()">Send test message</button>
    <button class="btn btn-sm" type="button" onclick="startWhatsAppBridge()">Start auth</button>
    <button class="btn btn-sm" type="button" onclick="stopWhatsAppBridge()">Stop auth</button>
    <button class="btn btn-sm" type="button" onclick="logoutWhatsAppBridge()">Logout + wipe</button>
    <button class="btn-primary btn-sm" type="button" onclick="saveWhatsApp()">Save</button>
  </div>
  <div id="channel-wizard-result" class="mt-2 text-xs"></div>
  <div id="wa-auth-panel" class="mt-3" style="display: none;">
    <div class="text-xs text-muted uppercase tracking-wider">WhatsApp auth</div>
    <div class="text-xs mt-1 text-muted">Scan the QR code to link your WhatsApp account.</div>
    <div class="mt-2" id="wa-auth-qr"></div>
  </div>
</div>

<script>
  refreshWhatsAppAuth();
</script>
