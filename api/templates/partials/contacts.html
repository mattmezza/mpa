{# Contacts tab partial #}
<div x-data='contactsTab({{ providers|tojson }})'>
  <div class="flex items-center justify-between gap-2 mb-4 flex-wrap">
    <div>
      <h3 class="text-xs text-muted uppercase tracking-wider">Contacts</h3>
      <p class="text-muted text-xs">Grant the agent access to one or more address book providers. Each provider syncs to its own local contact store.</p>
    </div>
    <button class="btn btn-sm" type="button" @click="addProvider()">Add provider</button>
  </div>

  <div class="grid gap-4">
    <template x-for="(provider, idx) in providers" :key="provider.id">
      <div class="card">
        <div class="flex items-center justify-between gap-2 mb-3">
          <div>
            <h4 class="text-sm">Provider <span x-text="idx + 1"></span></h4>
            <p class="text-muted text-xs">Pick a unique name so the agent can reference the source.</p>
          </div>
          <button class="btn-danger btn-sm" type="button" @click="removeProvider(idx)">Remove</button>
        </div>

        <div class="grid gap-3" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
          <div>
            <label class="label">Name</label>
            <input type="text" class="input-sm" x-model="provider.name" placeholder="icloud, google, work">
          </div>
          <div>
            <label class="label">Provider type</label>
            <select class="input-sm" x-model="provider.type">
              <option value="carddav">CardDAV</option>
              <option value="google_contacts">Google Contacts</option>
            </select>
          </div>
          <div x-show="provider.type === 'carddav'">
            <label class="label">CardDAV URL</label>
            <input type="text" class="input-sm" x-model="provider.url" placeholder="https://contacts.icloud.com/">
          </div>
          <div x-show="provider.type === 'carddav'">
            <label class="label">Username / email</label>
            <input type="text" class="input-sm" x-model="provider.username" placeholder="you@example.com">
          </div>
          <div x-show="provider.type === 'carddav'">
            <label class="label">App password</label>
            <input type="password" class="input-sm" x-model="provider.password" placeholder="xxxx xxxx xxxx xxxx" autocomplete="new-password">
          </div>
          <div x-show="provider.type === 'google_contacts'">
            <label class="label">Google Client ID</label>
            <input type="text" class="input-sm" x-model="provider.client_id" placeholder="...apps.googleusercontent.com">
          </div>
          <div x-show="provider.type === 'google_contacts'">
            <label class="label">Google Client Secret</label>
            <input type="password" class="input-sm" x-model="provider.client_secret" placeholder="GOCSPX-..." autocomplete="new-password">
          </div>
          <div x-show="provider.type === 'google_contacts'" class="flex items-center gap-2">
            <button class="btn btn-sm" type="button" @click="startGoogleOAuth(provider)">
              Connect Google Contacts
            </button>
            <span class="text-xs text-muted" x-text="provider.oauth_status"></span>
          </div>
        </div>

        <div class="mt-3 text-xs text-muted">
          <strong>Notes</strong>
          <ul class="list-disc ml-5 mt-1 space-y-1">
            <li>CardDAV providers include iCloud, Fastmail, and most work accounts.</li>
            <li>Google Contacts requires the CardDAV OAuth scope and a one-time authorization.</li>
            <li>Each provider syncs into its own folder under <code>~/.local/share/vdirsyncer/contacts/</code>.</li>
          </ul>
        </div>
      </div>
    </template>
    <template x-if="providers.length === 0">
      <div class="text-muted text-xs">No contact providers configured yet.</div>
    </template>
  </div>

  <div class="flex items-center gap-2 mt-4">
    <button class="btn-primary btn-sm" type="button" @click="saveProviders()">Save contacts</button>
    <span class="text-xs text-muted" x-text="status"></span>
  </div>
  <template x-if="result">
    <div :class="ok ? 'alert-success' : 'alert-error'" class="mt-2" x-text="result"></div>
  </template>
</div>
