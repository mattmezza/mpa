{# You tab partial — info about the user the assistant serves #}
<div class="space-y-6">
  {# Basic owner fields #}
  <div class="card" x-data="{
    ownerName: {{ owner_name|default('', true)|tojson|forceescape }},
    timezone: {{ timezone|default('', true)|tojson|forceescape }},
    result: '',
    ok: false
  }">
    <h2 class="text-base mb-1">About you</h2>
    <p class="text-muted text-xs mb-3">Tell the agent who you are — your name and timezone.</p>

    <div class="space-y-3">
      <div>
        <label class="label">Your name</label>
        <input type="text" class="input-sm" style="max-width:300px"
               x-model="ownerName" placeholder="Matteo">
      </div>
      <div>
        <label class="label">Timezone</label>
        <input type="text" class="input-sm" style="max-width:300px"
               x-model="timezone" placeholder="Europe/Zurich">
        <p class="text-muted text-xs mt-1">IANA timezone (e.g. Europe/Zurich, America/New_York, UTC).</p>
      </div>
    </div>

    <div class="flex justify-end mt-3">
      <button class="btn-primary btn-sm"
              @click="
                fetch('/config', {
                  method: 'PATCH',
                  headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + (localStorage.getItem('admin_api_key') || '')
                  },
                  body: JSON.stringify({values: {'agent.owner_name': ownerName, 'agent.timezone': timezone}})
                })
                .then(r => { ok = r.ok; return r.json(); })
                .then(d => {
                  result = ok ? 'Saved' : (d.detail || 'Error');
                  if (ok && window.showToast) { window.showToast('Saved'); }
                  if (ok && window.updateAdminGreeting) { window.updateAdminGreeting(ownerName, ''); }
                })
                .catch(e => { ok = false; result = e.message; })
              ">
        Save
      </button>
    </div>
    <template x-if="result">
      <div :class="ok ? 'alert-success' : 'alert-error'" class="mt-2" x-text="result"></div>
    </template>
  </div>

  {# Your personalia #}
  <div class="card" x-data="{ persResult: '', persOk: false }">
    <h2 class="text-base mb-1">Your personalia</h2>
    <p class="text-muted text-xs mb-3">Facts about you that the agent should know — preferences, routines, contacts, anything that helps it assist you better. Markdown format.</p>
    <textarea class="textarea" id="you-pers-editor"
              style="min-height:300px; font-size:0.8rem; line-height:1.5; tab-size:2"
              @keydown.tab.prevent="
                const start = $el.selectionStart;
                const end = $el.selectionEnd;
                $el.value = $el.value.substring(0, start) + '  ' + $el.value.substring(end);
                $el.selectionStart = $el.selectionEnd = start + 2;
              ">{{ you_personalia }}</textarea>
    <div class="flex justify-end mt-3">
      <button class="btn-primary btn-sm"
              @click="
                fetch('/config/you-personalia', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + (localStorage.getItem('admin_api_key') || '')
                  },
                  body: JSON.stringify({content: document.getElementById('you-pers-editor').value})
                })
                .then(r => { persOk = r.ok; return r.json(); })
                .then(d => {
                  persResult = persOk ? 'Personalia saved' : (d.detail || 'Error');
                  if (persOk && window.showToast) { window.showToast('Personalia saved'); }
                })
                .catch(e => { persOk = false; persResult = e.message; })
              ">
        Save personalia
      </button>
    </div>
    <template x-if="persResult">
      <div :class="persOk ? 'alert-success' : 'alert-error'" class="mt-2" x-text="persResult"></div>
    </template>
  </div>
</div>
