{# Skills tab partial #}
<div x-data="{
  filter: '',
  editName: '',
  editContent: '',
  editing: false,
  result: '',
  resultOk: false
}">
  <div class="flex items-center gap-2 mb-4 flex-wrap">
    <button class="btn btn-sm" hx-get="/partials/skills" hx-target="#tab-content" hx-swap="innerHTML">
      Refresh
    </button>
    <input type="text" class="input-sm flex-1" style="max-width:300px"
           placeholder="Filter skills..." x-model="filter">
    <span class="text-muted text-xs">{{ skills|length }} skills</span>
  </div>

  <div class="overflow-x-auto">
    <table class="table">
      <thead>
        <tr>
          <th class="min-w-[160px]">Name</th>
          <th>Summary</th>
          <th class="w-20"></th>
        </tr>
      </thead>
      <tbody>
        {% for skill in skills %}
        <tr x-show="!filter || {{ skill.name|tojson|forceescape }}.toLowerCase().includes(filter.toLowerCase()) || {{ (skill.summary or '')|tojson|forceescape }}.toLowerCase().includes(filter.toLowerCase())">
          <td class="text-xs break-all">{{ skill.name }}</td>
          <td class="text-xs">{{ skill.summary }}</td>
          <td class="whitespace-nowrap">
            <button class="btn btn-sm"
                    @click="editName = {{ skill.name|tojson|forceescape }}; editContent = {{ skill.content|tojson|forceescape }}; editing = true">
              edit
            </button>
            <button class="btn-danger btn-sm ml-0.5"
                    hx-post="/skills/delete" hx-target="#tab-content" hx-swap="innerHTML"
                    hx-vals='{"name": {{ skill.name|tojson }} }'
                    hx-confirm="Delete skill &quot;{{ skill.name }}&quot;?">
              x
            </button>
          </td>
        </tr>
        {% endfor %}
        {% if not skills %}
        <tr><td colspan="3" class="text-muted text-xs text-center py-4">No skills found</td></tr>
        {% endif %}
      </tbody>
    </table>
  </div>

  <h3 class="text-xs text-muted uppercase tracking-wider mt-5 mb-2">Add / edit skill</h3>
  <div class="flex gap-2 items-end flex-wrap">
    <div class="flex-1 min-w-[150px]">
      <label class="label">Name</label>
      <input type="text" class="input-sm" x-model="editName" :readonly="editing" placeholder="himalaya-email">
    </div>
    <div class="flex-[2] min-w-[200px]">
      <label class="label">Content (Markdown)</label>
      <textarea class="textarea" x-model="editContent" placeholder="# Skill\n\nHow to use it..."></textarea>
      <div class="hint">Use markdown. First non-empty line becomes summary.</div>
    </div>
    <button type="button" class="btn btn-sm"
            @click="
              fetch('/skills', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': 'Bearer ' + (localStorage.getItem('admin_api_key') || '')
                },
                body: JSON.stringify({name: editName, content: editContent})
              })
              .then(r => r.text())
              .then(html => { resultOk = true; result = 'Saved skill: ' + editName; editName = ''; editContent = ''; editing = false; document.getElementById('tab-content').innerHTML = html; })
              .catch(e => { resultOk = false; result = e.message; })
            ">
      Save
    </button>
    <button type="button" class="btn btn-sm" x-show="editing"
            @click="editName = ''; editContent = ''; editing = false; result = ''">
      Cancel
    </button>
  </div>
  <template x-if="result">
    <div :class="resultOk ? 'alert-success' : 'alert-error'" class="mt-2" x-text="result"></div>
  </template>
</div>
