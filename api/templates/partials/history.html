{# History tab partial #}
<div class="space-y-6" x-data="{
  dbPath: {{ db_path|default('data/agent.db', true)|tojson|forceescape }},
  maxTurns: {{ max_turns|default('10', true)|tojson|forceescape }},
  result: '',
  resultOk: false
}">
  <div class="card">
    <h2 class="text-base mb-1">Conversation History</h2>
    <p class="text-muted text-xs mb-4">Configure how conversation history is stored and how much context the agent sees when processing messages.</p>

    <div class="space-y-3">
      <div>
        <label class="label">Database path</label>
        <input type="text" class="input-sm" style="max-width:500px"
               x-model="dbPath" placeholder="data/agent.db">
        <p class="text-muted text-xs mt-1">SQLite database file for storing conversation turns.</p>
      </div>

      <div>
        <label class="label">Max turns</label>
        <input type="number" class="input-sm" style="max-width:120px"
               x-model="maxTurns" min="1" max="50">
        <p class="text-muted text-xs mt-1">Number of recent user-assistant pairs included as context. Lower values reduce noise from old conversations; higher values give more continuity.</p>
      </div>
    </div>

    <div class="flex items-center gap-2 mt-4">
      <button class="btn-primary btn-sm"
              @click="
                const vals = {
                  'history.db_path': dbPath,
                  'history.max_turns': String(maxTurns)
                };
                fetch('/config', {
                  method: 'PATCH',
                  headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + (localStorage.getItem('admin_api_key') || '')
                  },
                  body: JSON.stringify({values: vals})
                })
                .then(r => { resultOk = r.ok; return r.json(); })
                .then(d => {
                  result = resultOk ? 'History settings saved' : (d.detail || 'Error');
                  if (resultOk && window.showToast) { window.showToast('History settings saved'); }
                })
                .catch(e => { resultOk = false; result = e.message; })
              ">
        Save
      </button>
    </div>

    <template x-if="result">
      <div :class="resultOk ? 'alert-success' : 'alert-error'" class="mt-2" x-text="result"></div>
    </template>
  </div>
</div>
