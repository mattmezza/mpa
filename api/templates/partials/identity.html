{# Agent Identity tab partial #}
<div class="space-y-6">
  {# Basic identity fields #}
  <div class="card" x-data="{
    agentName: {{ agent_name|default('', true)|tojson }},
    ownerName: {{ owner_name|default('', true)|tojson }},
    timezone: {{ timezone|default('', true)|tojson }},
    idResult: '',
    idOk: false
  }">
    <h2 class="text-base mb-1">Identity</h2>
    <p class="text-muted text-xs mb-3">Basic agent identity — name, owner, and timezone.</p>

    <div class="space-y-3">
      <div>
        <label class="label">Agent name</label>
        <input type="text" class="input-sm" style="max-width:300px"
               x-model="agentName" placeholder="Clio">
      </div>
      <div>
        <label class="label">Owner name</label>
        <input type="text" class="input-sm" style="max-width:300px"
               x-model="ownerName" placeholder="Matteo">
      </div>
      <div>
        <label class="label">Timezone</label>
        <input type="text" class="input-sm" style="max-width:300px"
               x-model="timezone" placeholder="Europe/Zurich">
        <p class="text-muted text-xs mt-1">IANA timezone (e.g. Europe/Zurich, America/New_York, UTC).</p>
      </div>
    </div>

    <div class="flex justify-end mt-3">
      <button class="btn-primary btn-sm"
              @click="
                fetch('/config', {
                  method: 'PATCH',
                  headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + (localStorage.getItem('admin_api_key') || '')
                  },
                  body: JSON.stringify({values: {'agent.name': agentName, 'agent.owner_name': ownerName, 'agent.timezone': timezone}})
                })
                .then(r => { idOk = r.ok; return r.json(); })
                .then(d => { idResult = idOk ? 'Identity saved' : (d.detail || 'Error'); })
                .catch(e => { idOk = false; idResult = e.message; })
              ">
        Save identity
      </button>
    </div>
    <template x-if="idResult">
      <div :class="idOk ? 'alert-success' : 'alert-error'" class="mt-2" x-text="idResult"></div>
    </template>
  </div>

  {# Character #}
  <div class="card" x-data="{ charResult: '', charOk: false }">
    <h2 class="text-base mb-1">Character</h2>
    <p class="text-muted text-xs mb-3">Defines <em>how</em> the agent behaves — tone, decision-making style, language rules. Markdown format.</p>
    <textarea class="textarea" id="char-editor"
              style="min-height:300px; font-size:0.8rem; line-height:1.5; tab-size:2"
              @keydown.tab.prevent="
                const start = $el.selectionStart;
                const end = $el.selectionEnd;
                $el.value = $el.value.substring(0, start) + '  ' + $el.value.substring(end);
                $el.selectionStart = $el.selectionEnd = start + 2;
              ">{{ character }}</textarea>
    <div class="flex justify-end mt-3">
      <button class="btn-primary btn-sm"
              @click="
                fetch('/config/character', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + (localStorage.getItem('admin_api_key') || '')
                  },
                  body: JSON.stringify({content: document.getElementById('char-editor').value})
                })
                .then(r => { charOk = r.ok; return r.json(); })
                .then(d => { charResult = charOk ? 'Character saved' : (d.detail || 'Error'); })
                .catch(e => { charOk = false; charResult = e.message; })
              ">
        Save character
      </button>
    </div>
    <template x-if="charResult">
      <div :class="charOk ? 'alert-success' : 'alert-error'" class="mt-2" x-text="charResult"></div>
    </template>
  </div>

  {# Personalia #}
  <div class="card" x-data="{ persResult: '', persOk: false }">
    <h2 class="text-base mb-1">Personalia</h2>
    <p class="text-muted text-xs mb-3">Defines <em>what</em> the agent is — identity, capabilities, limitations, history. Markdown format.</p>
    <textarea class="textarea" id="pers-editor"
              style="min-height:300px; font-size:0.8rem; line-height:1.5; tab-size:2"
              @keydown.tab.prevent="
                const start = $el.selectionStart;
                const end = $el.selectionEnd;
                $el.value = $el.value.substring(0, start) + '  ' + $el.value.substring(end);
                $el.selectionStart = $el.selectionEnd = start + 2;
              ">{{ personalia }}</textarea>
    <div class="flex justify-end mt-3">
      <button class="btn-primary btn-sm"
              @click="
                fetch('/config/personalia', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + (localStorage.getItem('admin_api_key') || '')
                  },
                  body: JSON.stringify({content: document.getElementById('pers-editor').value})
                })
                .then(r => { persOk = r.ok; return r.json(); })
                .then(d => { persResult = persOk ? 'Personalia saved' : (d.detail || 'Error'); })
                .catch(e => { persOk = false; persResult = e.message; })
              ">
        Save personalia
      </button>
    </div>
    <template x-if="persResult">
      <div :class="persOk ? 'alert-success' : 'alert-error'" class="mt-2" x-text="persResult"></div>
    </template>
  </div>
</div>
