{# Admin tab partial #}
<div x-data="{ current: '', next: '', confirm: '', result: '', ok: false }">
  <h3 class="text-xs text-muted uppercase tracking-wider mb-2">Admin Password</h3>
  <p class="text-muted text-xs mb-4">Update the admin password used to access this dashboard.</p>

  <div class="flex gap-3 flex-wrap">
    <div class="flex-1 min-w-[200px]">
      <label class="label">Current password</label>
      <input type="password" class="input" x-model="current" placeholder="Current password">
    </div>
    <div class="flex-1 min-w-[200px]">
      <label class="label">New password</label>
      <input type="password" class="input" x-model="next" placeholder="New password">
    </div>
    <div class="flex-1 min-w-[200px]">
      <label class="label">Confirm new password</label>
      <input type="password" class="input" x-model="confirm" placeholder="Confirm new password">
    </div>
  </div>

  <div class="flex items-center gap-2 mt-4">
    <button class="btn btn-sm" type="button"
            @click="
              if (!current || !next || !confirm) { ok = false; result = 'All fields are required.'; return; }
              if (next !== confirm) { ok = false; result = 'New passwords do not match.'; return; }
              fetch('/admin/password', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': 'Bearer ' + (localStorage.getItem('admin_api_key') || '')
                },
                body: JSON.stringify({current_password: current, new_password: next})
              })
              .then(r => r.json())
              .then(d => {
                if (d.ok) {
                  ok = true; result = 'Password updated.';
                  current = ''; next = ''; confirm = '';
                  localStorage.setItem('admin_api_key', d.token || '');
                } else {
                  ok = false; result = d.error || 'Update failed.';
                }
              })
              .catch(e => { ok = false; result = e.message; })
            ">
      Update password
    </button>
  </div>
  <template x-if="result">
    <div :class="ok ? 'alert-success' : 'alert-error'" class="mt-3" x-text="result"></div>
  </template>
</div>
