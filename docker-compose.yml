services:
  agent:
    build: .
    container_name: mpa
    restart: unless-stopped
    ports:
      - "8000:8000"
    volumes:
      - ./data:/app/data
      - ./config.yml:/app/config.yml:ro
      - ./character.md:/app/character.md:ro
      - ./personalia.md:/app/personalia.md
      - ./skills:/app/skills:ro
      - ./cli-configs/himalaya.toml:/root/.config/himalaya/config.toml:ro
      - ./cli-configs/khard.conf:/root/.config/khard/khard.conf:ro
      - ./cli-configs/vdirsyncer.conf:/root/.config/vdirsyncer/config:ro
      - ./data/vdirsyncer:/root/.local/share/vdirsyncer
    env_file: .env

  wa-bridge:
    build:
      context: ./tools/wa-bridge
    container_name: mpa-wa-bridge
    restart: unless-stopped
    ports:
      - "3001:3001"
    environment:
      AGENT_WEBHOOK: http://agent:8000/webhook/whatsapp
      BRIDGE_TOKEN: ${WA_BRIDGE_TOKEN:-}
      AUTH_PATH: /app/.wwebjs_auth
      CACHE_PATH: /app/.wwebjs_cache
      CLIENT_ID: mpa
    volumes:
      - ./data/wa-bridge-auth:/app/.wwebjs_auth
      - ./data/wa-bridge-cache:/app/.wwebjs_cache
    depends_on:
      - agent
